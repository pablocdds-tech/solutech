-- =============================================
-- Vitaliano ERP — Seed Completo
-- Dados iniciais para testar o sistema ponta a ponta.
--
-- PASSO 1: Execute este script no SQL Editor do Supabase.
-- PASSO 2: Crie um usuário via Auth (veja instruções no final).
-- PASSO 3: Execute o script de vinculação do usuário (00019_seed_user_bind.sql).
-- =============================================

-- ===================
-- ORG (idempotente)
-- ===================
INSERT INTO public.orgs (id, name, slug, settings)
VALUES (
  '00000000-0000-0000-0000-000000000001',
  'Vitaliano',
  'vitaliano',
  '{"timezone": "America/Fortaleza", "currency": "BRL"}'::jsonb
)
ON CONFLICT (slug) DO UPDATE SET settings = EXCLUDED.settings;

-- ===================
-- LOJAS (idempotente)
-- ===================
INSERT INTO public.stores (id, org_id, name, slug, type, cnpj, address, is_active)
VALUES
  (
    '00000000-0000-0000-0000-000000000010',
    '00000000-0000-0000-0000-000000000001',
    'Vitaliano NB',
    'nb',
    'store',
    '12.345.678/0001-01',
    'Av. Principal, 100 - NB, Fortaleza-CE',
    true
  ),
  (
    '00000000-0000-0000-0000-000000000011',
    '00000000-0000-0000-0000-000000000001',
    'Vitaliano Praça',
    'praca',
    'store',
    '12.345.678/0002-02',
    'Praça Central, 50 - Centro, Fortaleza-CE',
    true
  ),
  (
    '00000000-0000-0000-0000-000000000012',
    '00000000-0000-0000-0000-000000000001',
    'CD Vitaliano',
    'cd',
    'cd',
    NULL,
    'Rua do Galpão, 200 - Distrito Industrial, Fortaleza-CE',
    true
  )
ON CONFLICT (org_id, slug) DO UPDATE SET
  name = EXCLUDED.name,
  cnpj = EXCLUDED.cnpj,
  address = EXCLUDED.address;

-- ===================
-- UNIDADES
-- ===================
INSERT INTO public.units (id, org_id, name, abbreviation, is_active)
VALUES
  ('00000000-0000-0000-0001-000000000001', '00000000-0000-0000-0000-000000000001', 'Quilograma', 'kg', true),
  ('00000000-0000-0000-0001-000000000002', '00000000-0000-0000-0000-000000000001', 'Grama', 'g', true),
  ('00000000-0000-0000-0001-000000000003', '00000000-0000-0000-0000-000000000001', 'Litro', 'L', true),
  ('00000000-0000-0000-0001-000000000004', '00000000-0000-0000-0000-000000000001', 'Mililitro', 'mL', true),
  ('00000000-0000-0000-0001-000000000005', '00000000-0000-0000-0000-000000000001', 'Unidade', 'un', true),
  ('00000000-0000-0000-0001-000000000006', '00000000-0000-0000-0000-000000000001', 'Caixa', 'cx', true),
  ('00000000-0000-0000-0001-000000000007', '00000000-0000-0000-0000-000000000001', 'Pacote', 'pct', true),
  ('00000000-0000-0000-0001-000000000008', '00000000-0000-0000-0000-000000000001', 'Fardo', 'fd', true),
  ('00000000-0000-0000-0001-000000000009', '00000000-0000-0000-0000-000000000001', 'Dúzia', 'dz', true),
  ('00000000-0000-0000-0001-000000000010', '00000000-0000-0000-0000-000000000001', 'Bandeja', 'bdj', true)
ON CONFLICT DO NOTHING;

-- Conversões comuns
INSERT INTO public.unit_conversions (org_id, from_unit_id, to_unit_id, factor)
VALUES
  ('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0001-000000000001', '00000000-0000-0000-0001-000000000002', 1000),
  ('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0001-000000000003', '00000000-0000-0000-0001-000000000004', 1000),
  ('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0001-000000000009', '00000000-0000-0000-0001-000000000005', 12)
ON CONFLICT DO NOTHING;

-- ===================
-- GRUPOS DE INGREDIENTES
-- ===================
INSERT INTO public.ingredient_groups (id, org_id, name, description, is_active)
VALUES
  ('00000000-0000-0000-0002-000000000001', '00000000-0000-0000-0000-000000000001', 'Carnes', 'Carnes bovinas, suínas, aves e peixes', true),
  ('00000000-0000-0000-0002-000000000002', '00000000-0000-0000-0000-000000000001', 'Laticínios', 'Leite, queijos, manteigas, cremes', true),
  ('00000000-0000-0000-0002-000000000003', '00000000-0000-0000-0000-000000000001', 'Hortifrúti', 'Verduras, legumes, frutas', true),
  ('00000000-0000-0000-0002-000000000004', '00000000-0000-0000-0000-000000000001', 'Secos e Grãos', 'Farinhas, arroz, feijão, massas', true),
  ('00000000-0000-0000-0002-000000000005', '00000000-0000-0000-0000-000000000001', 'Bebidas', 'Refrigerantes, sucos, água, cervejas', true),
  ('00000000-0000-0000-0002-000000000006', '00000000-0000-0000-0000-000000000001', 'Temperos e Molhos', 'Sal, pimenta, azeite, molhos prontos', true),
  ('00000000-0000-0000-0002-000000000007', '00000000-0000-0000-0000-000000000001', 'Embalagens', 'Caixas, sacolas, descartáveis, papel', true),
  ('00000000-0000-0000-0002-000000000008', '00000000-0000-0000-0000-000000000001', 'Limpeza', 'Detergente, álcool, desinfetante', true)
ON CONFLICT DO NOTHING;

-- ===================
-- ITENS (produtos, insumos, suprimentos)
-- ===================
INSERT INTO public.items (id, org_id, name, normalized_name, type, ingredient_group_id, default_unit_id, min_stock, max_stock, is_active, settings)
VALUES
  -- Carnes
  ('00000000-0000-0000-0003-000000000001', '00000000-0000-0000-0000-000000000001', 'Filé Mignon', 'file mignon', 'ingredient', '00000000-0000-0000-0002-000000000001', '00000000-0000-0000-0001-000000000001', 5, 50, true, '{}'),
  ('00000000-0000-0000-0003-000000000002', '00000000-0000-0000-0000-000000000001', 'Picanha', 'picanha', 'ingredient', '00000000-0000-0000-0002-000000000001', '00000000-0000-0000-0001-000000000001', 5, 40, true, '{}'),
  ('00000000-0000-0000-0003-000000000003', '00000000-0000-0000-0000-000000000001', 'Peito de Frango', 'peito de frango', 'ingredient', '00000000-0000-0000-0002-000000000001', '00000000-0000-0000-0001-000000000001', 10, 80, true, '{}'),
  ('00000000-0000-0000-0003-000000000004', '00000000-0000-0000-0000-000000000001', 'Linguiça Calabresa', 'linguica calabresa', 'ingredient', '00000000-0000-0000-0002-000000000001', '00000000-0000-0000-0001-000000000001', 5, 30, true, '{}'),
  -- Laticínios
  ('00000000-0000-0000-0003-000000000005', '00000000-0000-0000-0000-000000000001', 'Queijo Mussarela', 'queijo mussarela', 'ingredient', '00000000-0000-0000-0002-000000000002', '00000000-0000-0000-0001-000000000001', 5, 40, true, '{}'),
  ('00000000-0000-0000-0003-000000000006', '00000000-0000-0000-0000-000000000001', 'Creme de Leite', 'creme de leite', 'ingredient', '00000000-0000-0000-0002-000000000002', '00000000-0000-0000-0001-000000000003', 5, 30, true, '{}'),
  ('00000000-0000-0000-0003-000000000007', '00000000-0000-0000-0000-000000000001', 'Manteiga', 'manteiga', 'ingredient', '00000000-0000-0000-0002-000000000002', '00000000-0000-0000-0001-000000000001', 2, 15, true, '{}'),
  -- Hortifrúti
  ('00000000-0000-0000-0003-000000000008', '00000000-0000-0000-0000-000000000001', 'Tomate', 'tomate', 'ingredient', '00000000-0000-0000-0002-000000000003', '00000000-0000-0000-0001-000000000001', 5, 30, true, '{}'),
  ('00000000-0000-0000-0003-000000000009', '00000000-0000-0000-0000-000000000001', 'Cebola', 'cebola', 'ingredient', '00000000-0000-0000-0002-000000000003', '00000000-0000-0000-0001-000000000001', 5, 25, true, '{}'),
  ('00000000-0000-0000-0003-000000000010', '00000000-0000-0000-0000-000000000001', 'Alface', 'alface', 'ingredient', '00000000-0000-0000-0002-000000000003', '00000000-0000-0000-0001-000000000005', 10, 50, true, '{}'),
  -- Secos
  ('00000000-0000-0000-0003-000000000011', '00000000-0000-0000-0000-000000000001', 'Arroz Branco 5kg', 'arroz branco 5kg', 'ingredient', '00000000-0000-0000-0002-000000000004', '00000000-0000-0000-0001-000000000007', 5, 30, true, '{}'),
  ('00000000-0000-0000-0003-000000000012', '00000000-0000-0000-0000-000000000001', 'Farinha de Trigo', 'farinha de trigo', 'ingredient', '00000000-0000-0000-0002-000000000004', '00000000-0000-0000-0001-000000000001', 5, 40, true, '{}'),
  -- Bebidas
  ('00000000-0000-0000-0003-000000000013', '00000000-0000-0000-0000-000000000001', 'Coca-Cola 2L', 'coca cola 2l', 'product', '00000000-0000-0000-0002-000000000005', '00000000-0000-0000-0001-000000000005', 20, 200, true, '{}'),
  ('00000000-0000-0000-0003-000000000014', '00000000-0000-0000-0000-000000000001', 'Água Mineral 500ml', 'agua mineral 500ml', 'product', '00000000-0000-0000-0002-000000000005', '00000000-0000-0000-0001-000000000005', 50, 500, true, '{}'),
  -- Embalagens
  ('00000000-0000-0000-0003-000000000015', '00000000-0000-0000-0000-000000000001', 'Embalagem Marmitex G', 'embalagem marmitex g', 'supply', '00000000-0000-0000-0002-000000000007', '00000000-0000-0000-0001-000000000005', 100, 1000, true, '{}'),
  ('00000000-0000-0000-0003-000000000016', '00000000-0000-0000-0000-000000000001', 'Guardanapo Pct 100un', 'guardanapo pct 100un', 'supply', '00000000-0000-0000-0002-000000000007', '00000000-0000-0000-0001-000000000007', 10, 50, true, '{}'),
  -- Temperos
  ('00000000-0000-0000-0003-000000000017', '00000000-0000-0000-0000-000000000001', 'Azeite Extra Virgem 500ml', 'azeite extra virgem 500ml', 'ingredient', '00000000-0000-0000-0002-000000000006', '00000000-0000-0000-0001-000000000005', 5, 20, true, '{}'),
  ('00000000-0000-0000-0003-000000000018', '00000000-0000-0000-0000-000000000001', 'Sal Refinado 1kg', 'sal refinado 1kg', 'ingredient', '00000000-0000-0000-0002-000000000006', '00000000-0000-0000-0001-000000000005', 5, 30, true, '{}'),
  -- Produto final
  ('00000000-0000-0000-0003-000000000019', '00000000-0000-0000-0000-000000000001', 'Marmitex Executivo', 'marmitex executivo', 'product', NULL, '00000000-0000-0000-0001-000000000005', NULL, NULL, true, '{}'),
  ('00000000-0000-0000-0003-000000000020', '00000000-0000-0000-0000-000000000001', 'Marmitex Simples', 'marmitex simples', 'product', NULL, '00000000-0000-0000-0001-000000000005', NULL, NULL, true, '{}')
ON CONFLICT DO NOTHING;

-- ===================
-- FORNECEDORES
-- ===================
INSERT INTO public.suppliers (id, org_id, name, normalized_name, cnpj, phone, city, state, is_active)
VALUES
  ('00000000-0000-0000-0004-000000000001', '00000000-0000-0000-0000-000000000001', 'Frigorífico São José', 'frigorifico sao jose', '11.222.333/0001-01', '(85) 3333-1111', 'Fortaleza', 'CE', true),
  ('00000000-0000-0000-0004-000000000002', '00000000-0000-0000-0000-000000000001', 'Distribuidora Ceará Bebidas', 'distribuidora ceara bebidas', '22.333.444/0001-02', '(85) 3333-2222', 'Maracanaú', 'CE', true),
  ('00000000-0000-0000-0004-000000000003', '00000000-0000-0000-0000-000000000001', 'Atacadão Hortifrúti', 'atacadao hortifruiti', '33.444.555/0001-03', '(85) 3333-3333', 'Fortaleza', 'CE', true),
  ('00000000-0000-0000-0004-000000000004', '00000000-0000-0000-0000-000000000001', 'Laticínios Bom Gosto', 'laticinios bom gosto', '44.555.666/0001-04', '(85) 3333-4444', 'Caucaia', 'CE', true),
  ('00000000-0000-0000-0004-000000000005', '00000000-0000-0000-0000-000000000001', 'Embalagens Nordeste', 'embalagens nordeste', '55.666.777/0001-05', '(85) 3333-5555', 'Fortaleza', 'CE', true),
  ('00000000-0000-0000-0004-000000000006', '00000000-0000-0000-0000-000000000001', 'Secos e Molhados Ltda', 'secos e molhados ltda', '66.777.888/0001-06', '(85) 3333-6666', 'Fortaleza', 'CE', true)
ON CONFLICT DO NOTHING;

-- ===================
-- CATEGORIAS FINANCEIRAS
-- ===================
INSERT INTO public.finance_categories (id, org_id, name, type, sort_order, is_active)
VALUES
  -- Receitas
  ('00000000-0000-0000-0005-000000000001', '00000000-0000-0000-0000-000000000001', 'Vendas Loja', 'revenue', 1, true),
  ('00000000-0000-0000-0005-000000000002', '00000000-0000-0000-0000-000000000001', 'Vendas iFood', 'revenue', 2, true),
  ('00000000-0000-0000-0005-000000000003', '00000000-0000-0000-0000-000000000001', 'Vendas Delivery WhatsApp', 'revenue', 3, true),
  ('00000000-0000-0000-0005-000000000004', '00000000-0000-0000-0000-000000000001', 'Outras Receitas', 'revenue', 4, true),
  -- Despesas
  ('00000000-0000-0000-0005-000000000010', '00000000-0000-0000-0000-000000000001', 'Compras Mercadoria', 'expense', 10, true),
  ('00000000-0000-0000-0005-000000000011', '00000000-0000-0000-0000-000000000001', 'Folha de Pagamento', 'expense', 11, true),
  ('00000000-0000-0000-0005-000000000012', '00000000-0000-0000-0000-000000000001', 'Aluguel', 'expense', 12, true),
  ('00000000-0000-0000-0005-000000000013', '00000000-0000-0000-0000-000000000001', 'Energia Elétrica', 'expense', 13, true),
  ('00000000-0000-0000-0005-000000000014', '00000000-0000-0000-0000-000000000001', 'Água e Esgoto', 'expense', 14, true),
  ('00000000-0000-0000-0005-000000000015', '00000000-0000-0000-0000-000000000001', 'Gás', 'expense', 15, true),
  ('00000000-0000-0000-0005-000000000016', '00000000-0000-0000-0000-000000000001', 'Internet / Telefone', 'expense', 16, true),
  ('00000000-0000-0000-0005-000000000017', '00000000-0000-0000-0000-000000000001', 'Materiais de Limpeza', 'expense', 17, true),
  ('00000000-0000-0000-0005-000000000018', '00000000-0000-0000-0000-000000000001', 'Manutenção Equipamentos', 'expense', 18, true),
  ('00000000-0000-0000-0005-000000000019', '00000000-0000-0000-0000-000000000001', 'Taxas e Impostos', 'expense', 19, true),
  ('00000000-0000-0000-0005-000000000020', '00000000-0000-0000-0000-000000000001', 'Outras Despesas', 'expense', 20, true)
ON CONFLICT DO NOTHING;

-- ===================
-- FORMAS DE PAGAMENTO
-- ===================
INSERT INTO public.payment_methods (id, org_id, name, type, days_to_receive, fee_percent, is_active)
VALUES
  ('00000000-0000-0000-0006-000000000001', '00000000-0000-0000-0000-000000000001', 'Dinheiro', 'cash', 0, 0, true),
  ('00000000-0000-0000-0006-000000000002', '00000000-0000-0000-0000-000000000001', 'PIX', 'pix', 0, 0, true),
  ('00000000-0000-0000-0006-000000000003', '00000000-0000-0000-0000-000000000001', 'Cartão Débito', 'debit_card', 1, 1.5, true),
  ('00000000-0000-0000-0006-000000000004', '00000000-0000-0000-0000-000000000001', 'Cartão Crédito à Vista', 'credit_card', 30, 3.5, true),
  ('00000000-0000-0000-0006-000000000005', '00000000-0000-0000-0000-000000000001', 'Cartão Crédito 2x', 'credit_card', 60, 4.5, true),
  ('00000000-0000-0000-0006-000000000006', '00000000-0000-0000-0000-000000000001', 'Cartão Crédito 3x', 'credit_card', 90, 5.5, true),
  ('00000000-0000-0000-0006-000000000007', '00000000-0000-0000-0000-000000000001', 'Boleto', 'boleto', 30, 0, true),
  ('00000000-0000-0000-0006-000000000008', '00000000-0000-0000-0000-000000000001', 'Transferência Bancária', 'bank_transfer', 0, 0, true),
  ('00000000-0000-0000-0006-000000000009', '00000000-0000-0000-0000-000000000001', 'Voucher Alimentação', 'voucher', 30, 5, true)
ON CONFLICT DO NOTHING;

-- ===================
-- CANAIS DE VENDA
-- ===================
INSERT INTO public.sales_channels (id, org_id, name, type, fee_percent, is_active)
VALUES
  ('00000000-0000-0000-0007-000000000001', '00000000-0000-0000-0000-000000000001', 'Balcão Loja', 'store', 0, true),
  ('00000000-0000-0000-0007-000000000002', '00000000-0000-0000-0000-000000000001', 'iFood', 'ifood', 27, true),
  ('00000000-0000-0000-0007-000000000003', '00000000-0000-0000-0000-000000000001', 'Rappi', 'rappi', 25, true),
  ('00000000-0000-0000-0007-000000000004', '00000000-0000-0000-0000-000000000001', 'WhatsApp', 'whatsapp', 0, true),
  ('00000000-0000-0000-0007-000000000005', '00000000-0000-0000-0000-000000000001', 'Telefone', 'phone', 0, true),
  ('00000000-0000-0000-0007-000000000006', '00000000-0000-0000-0000-000000000001', 'CD → Loja (interno)', 'other', 0, true)
ON CONFLICT DO NOTHING;

-- ===================
-- CENTROS DE CUSTO
-- ===================
INSERT INTO public.cost_centers (id, org_id, store_id, name, code, is_active)
VALUES
  ('00000000-0000-0000-0008-000000000001', '00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000010', 'Cozinha NB', 'COZ-NB', true),
  ('00000000-0000-0000-0008-000000000002', '00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000011', 'Cozinha Praça', 'COZ-PR', true),
  ('00000000-0000-0000-0008-000000000003', '00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000012', 'Galpão CD', 'GAL-CD', true),
  ('00000000-0000-0000-0008-000000000004', '00000000-0000-0000-0000-000000000001', NULL, 'Administrativo', 'ADM', true),
  ('00000000-0000-0000-0008-000000000005', '00000000-0000-0000-0000-000000000001', NULL, 'Marketing', 'MKT', true)
ON CONFLICT DO NOTHING;

-- ===================
-- CONTAS BANCÁRIAS
-- ===================
INSERT INTO public.bank_accounts (id, org_id, store_id, name, bank_name, agency, account_number, account_type, is_active)
VALUES
  ('00000000-0000-0000-0009-000000000001', '00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000010', 'Conta NB - Bradesco', 'Bradesco', '1234', '56789-0', 'checking', true),
  ('00000000-0000-0000-0009-000000000002', '00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000011', 'Conta Praça - Itaú', 'Itaú', '5678', '12345-6', 'checking', true),
  ('00000000-0000-0000-0009-000000000003', '00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000010', 'Caixa Econômica NB', 'Caixa', '0001', '98765-4', 'savings', true)
ON CONFLICT DO NOTHING;

-- ===================
-- MOTIVOS DE AJUSTE
-- ===================
INSERT INTO public.adjustment_reasons (id, org_id, name, direction, requires_approval, is_active)
VALUES
  ('00000000-0000-0000-000a-000000000001', '00000000-0000-0000-0000-000000000001', 'Contagem / Inventário', 'both', true, true),
  ('00000000-0000-0000-000a-000000000002', '00000000-0000-0000-0000-000000000001', 'Perda / Avaria', 'negative', false, true),
  ('00000000-0000-0000-000a-000000000003', '00000000-0000-0000-0000-000000000001', 'Vencimento', 'negative', false, true),
  ('00000000-0000-0000-000a-000000000004', '00000000-0000-0000-0000-000000000001', 'Bonificação recebida', 'positive', false, true),
  ('00000000-0000-0000-000a-000000000005', '00000000-0000-0000-0000-000000000001', 'Erro de lançamento (correção)', 'both', true, true),
  ('00000000-0000-0000-000a-000000000006', '00000000-0000-0000-0000-000000000001', 'Consumo interno', 'negative', false, true)
ON CONFLICT DO NOTHING;

-- ===================
-- VERIFICAÇÃO FINAL
-- ===================
DO $$
DECLARE
  v_units int; v_items int; v_suppliers int; v_cats int; v_pm int; v_ch int;
BEGIN
  SELECT count(*) INTO v_units FROM units WHERE org_id = '00000000-0000-0000-0000-000000000001';
  SELECT count(*) INTO v_items FROM items WHERE org_id = '00000000-0000-0000-0000-000000000001';
  SELECT count(*) INTO v_suppliers FROM suppliers WHERE org_id = '00000000-0000-0000-0000-000000000001';
  SELECT count(*) INTO v_cats FROM finance_categories WHERE org_id = '00000000-0000-0000-0000-000000000001';
  SELECT count(*) INTO v_pm FROM payment_methods WHERE org_id = '00000000-0000-0000-0000-000000000001';
  SELECT count(*) INTO v_ch FROM sales_channels WHERE org_id = '00000000-0000-0000-0000-000000000001';

  RAISE NOTICE 'SEED: Unidades=% | Itens=% | Fornecedores=% | Cat.Financeiras=% | Formas Pgto=% | Canais Venda=%',
    v_units, v_items, v_suppliers, v_cats, v_pm, v_ch;
END $$;

-- =============================================
-- PRÓXIMO PASSO:
--
-- 1) Acesse Supabase Dashboard > Authentication > Users
-- 2) Clique "Add user" > "Create new user"
-- 3) Preencha e-mail e senha
-- 4) Depois de criar, anote o UUID do usuário
-- 5) Execute o script 00019_seed_user_bind.sql trocando
--    '<USER_UUID_AQUI>' pelo UUID real
-- =============================================
